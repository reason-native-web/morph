<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>index (lwt.index)</title><link rel="stylesheet" href="../odoc-theme/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – lwt</nav><h1 id="package-lwt"><a href="#package-lwt" class="anchor"></a>Package lwt <span class="version">5.3.0</span> <nav><a type="text/plain; charset=UTF-8" href="_doc-dir/CHANGES">changes</a> <a href="https://github.com/ocsigen/lwt/issues">issues</a> <a href="#package_info">more…</a></nav></h1><nav class="toc"><ul><li><a href="#introduction">Introduction</a></li><li><a href="#tour">Tour</a></li><li><a href="#installing">Installing</a></li><li><a href="#additional-docs">Additional Docs</a></li><li><a href="#api:-library-lwt">API: Library <code>lwt</code></a></li><li><a href="#api:-library-lwt.unix">API: Library <code>lwt.unix</code></a></li><li><a href="#package_info">Package info</a></li></ul></nav></header><h2 id="introduction"><a href="#introduction" class="anchor"></a>Introduction</h2><p>Lwt is a concurrent programming library for OCaml. It provides a single data type: the <em>promise</em>, which is a value that will become determined in the future. Creating a promise spawns a computation. When that computation is I/O, Lwt runs it in parallel with your OCaml code.</p><p>OCaml code, including creating and waiting on promises, is run in a single thread by default, so you don't have to worry about locking or preemption. You can detach code to be run in separate threads on an opt-in basis.</p><p>Here is a simplistic Lwt program which requests the Google front page, and fails if the request is not completed in five seconds:</p><pre><code class="ml">open Lwt.Syntax

let () =
  let request =
    let* addresses = Lwt_unix.getaddrinfo &quot;google.com&quot; &quot;80&quot; [] in
    let google = Lwt_unix.((List.hd addresses).ai_addr) in

    Lwt_io.(with_connection google (fun (incoming, outgoing) -&gt;
      let* () = write outgoing &quot;GET / HTTP/1.1\r\n&quot; in
      let* () = write outgoing &quot;Connection: close\r\n\r\n&quot; in
      let* response = read incoming in
      Lwt.return (Some response)))
  in

  let timeout =
    let* () = Lwt_unix.sleep 5. in
    Lwt.return None
  in

  match Lwt_main.run (Lwt.pick [request; timeout]) with
  | Some response -&gt; print_string response
  | None -&gt; prerr_endline &quot;Request timed out&quot;; exit 1

(* ocamlfind opt -package lwt.unix -linkpkg example.ml &amp;&amp; ./a.out *)</code></pre><p>In the program, functions such as <code>Lwt_io.write</code> create promises. The <code>let%lwt ... in</code> construct is used to wait for a promise to become determined; the code after <code>in</code> is scheduled to run in a &quot;callback.&quot; <code>Lwt.pick</code> races promises against each other, and behaves as the first one to complete. <code>Lwt_main.run</code> forces the whole promise-computation network to be executed. All the visible OCaml code is run in a single thread, but Lwt internally uses a combination of worker threads and non-blocking file descriptors to resolve in parallel the promises that do I/O.</p><h2 id="tour"><a href="#tour" class="anchor"></a>Tour</h2><p>Lwt compiles to native code on Linux, macOS, Windows, and other systems. It's also routinely compiled to JavaScript for the front end and Node by js_of_ocaml.</p><p>In Lwt,</p><ul><li>The core library <a href="Lwt/index.html"><code>Lwt</code></a> provides promises...</li><li>...and a few pure-OCaml helpers, such as promise-friendly <a href="Lwt_mutex/index.html"><span>mutexes</span></a>, <a href="Lwt_condition/index.html"><span>condition variables</span></a>, and <a href="Lwt_mvar/index.html"><span>mvars</span></a>.</li><li>There is a big Unix binding, <a href="Lwt_unix/index.html"><code>Lwt_unix</code></a>, that binds almost every Unix system call. A higher-level module <a href="Lwt_io/index.html"><code>Lwt_io</code></a> provides nice I/O channels.</li><li><a href="Lwt_process/index.html"><code>Lwt_process</code></a> is for subprocess handling.</li><li><a href="Lwt_preemptive/index.html"><code>Lwt_preemptive</code></a> spawns system threads.</li></ul><h2 id="installing"><a href="#installing" class="anchor"></a>Installing</h2><ol><li>Use your system package manager to install a development libev package. It is often called <code>libev-dev</code> or <code>libev-devel</code>.</li><li><code>opam install conf-libev lwt</code></li></ol><h2 id="additional-docs"><a href="#additional-docs" class="anchor"></a>Additional Docs</h2><ul><li><a href="http://ocsigen.org/lwt/">Online manual</a>.</li><li><a href="https://github.com/dkim/rwo-lwt#readme">Concurrent Programming with Lwt</a> is a nice source of Lwt examples. They are translations of code from Real World OCaml, but are just as useful if you are not reading the book.</li><li><a href="https://mirage.io/wiki/tutorial-lwt">Mirage Lwt tutorial</a>.</li><li><a href="http://www.baturin.org/code/lwt-counter-server/">Example server</a> written with Lwt.</li></ul><h2 id="api:-library-lwt"><a href="#api:-library-lwt" class="anchor"></a>API: Library <code>lwt</code></h2><p>This is the system-independent, pure-OCaml core of Lwt. To link with it, use <code>(libraries lwt)</code> in your <code>dune</code> file.</p><ul class="modules"><li><a href="Lwt/index.html"><code>Lwt</code></a></li><li><a href="Lwt_list/index.html"><code>Lwt_list</code></a></li><li><a href="Lwt_stream/index.html"><code>Lwt_stream</code></a></li><li><a href="Lwt_result/index.html"><code>Lwt_result</code></a></li><li><a href="Lwt_mutex/index.html"><code>Lwt_mutex</code></a></li><li><a href="Lwt_condition/index.html"><code>Lwt_condition</code></a></li><li><a href="Lwt_mvar/index.html"><code>Lwt_mvar</code></a></li><li><a href="Lwt_switch/index.html"><code>Lwt_switch</code></a></li><li><a href="Lwt_pool/index.html"><code>Lwt_pool</code></a></li></ul><h2 id="api:-library-lwt.unix"><a href="#api:-library-lwt.unix" class="anchor"></a>API: Library <code>lwt.unix</code></h2><p>This is the system call and I/O library. Despite its name, it is implemented on both Unix-like systems and Windows, although not all functions are available on Windows. To link with this library, use <code>(libraries lwt.unix)</code> in your <code>dune</code> file.</p><ul class="modules"><li><a href="Lwt_unix/index.html"><code>Lwt_unix</code></a></li><li><a href="Lwt_main/index.html"><code>Lwt_main</code></a></li><li><a href="Lwt_io/index.html"><code>Lwt_io</code></a></li><li><a href="Lwt_process/index.html"><code>Lwt_process</code></a></li><li><a href="Lwt_bytes/index.html"><code>Lwt_bytes</code></a></li><li><a href="Lwt_preemptive/index.html"><code>Lwt_preemptive</code></a></li><li><a href="Lwt_fmt/index.html"><code>Lwt_fmt</code></a></li><li><a href="Lwt_throttle/index.html"><code>Lwt_throttle</code></a></li><li><a href="Lwt_timeout/index.html"><code>Lwt_timeout</code></a></li><li><a href="Lwt_engine/index.html"><code>Lwt_engine</code></a></li><li><a href="Lwt_gc/index.html"><code>Lwt_gc</code></a></li><li><a href="Lwt_sys/index.html"><code>Lwt_sys</code></a></li></ul><h2 id="package_info"><a href="#package_info" class="anchor"></a>Package info</h2><table class="package info"><tr id="info-authors"><td><a href="#info-authors" aria-hidden="true" class="anchor"></a>authors</td><td><ul><li>Jérémie Dimino</li><li>Jérôme Vouillon</li></ul></td></tr><tr id="info-changes-files"><td><a href="#info-changes-files" aria-hidden="true" class="anchor"></a>changes-files</td><td><ul><li><a type="text/plain; charset=UTF-8" href="_doc-dir/CHANGES">CHANGES</a></li></ul></td></tr><tr id="info-depends"><td><a href="#info-depends" aria-hidden="true" class="anchor"></a>depends</td><td><ul><li><a href="../bisect_ppx/index.html">bisect_ppx</a></li><li><a href="../cppo/index.html">cppo</a></li><li><a href="../dune/index.html">dune</a></li><li><a href="../dune-configurator/index.html">dune-configurator</a></li><li><a href="../mmap/index.html">mmap</a></li><li><a href="../ocaml/index.html">ocaml</a></li><li><a href="../ocaml/index.html">ocaml</a></li><li><a href="../ocaml-syntax-shims/index.html">ocaml-syntax-shims</a></li><li><a href="../ocamlfind/index.html">ocamlfind</a></li><li><a href="../ocplib-endian/index.html">ocplib-endian</a></li><li><a href="../result/index.html">result</a></li><li><a href="../seq/index.html">seq</a></li></ul></td></tr><tr id="info-homepage"><td><a href="#info-homepage" aria-hidden="true" class="anchor"></a>homepage</td><td><ul><li><a href="https://github.com/ocsigen/lwt">https://github.com/ocsigen/lwt</a></li></ul></td></tr><tr id="info-issues"><td><a href="#info-issues" aria-hidden="true" class="anchor"></a>issues</td><td><ul><li><a href="https://github.com/ocsigen/lwt/issues">https://github.com/ocsigen/lwt/issues</a></li></ul></td></tr><tr id="info-license"><td><a href="#info-license" aria-hidden="true" class="anchor"></a>license</td><td><ul><li>MIT</li></ul></td></tr><tr id="info-license-files"><td><a href="#info-license-files" aria-hidden="true" class="anchor"></a>license-files</td><td><ul><li><a type="text/plain; charset=UTF-8" href="_doc-dir/LICENSE.md">LICENSE.md</a></li></ul></td></tr><tr id="info-maintainers"><td><a href="#info-maintainers" aria-hidden="true" class="anchor"></a>maintainers</td><td><ul><li>Anton Bachin &lt;antonbachin&commat;yahoo.com&gt;</li></ul></td></tr><tr id="info-online-doc"><td><a href="#info-online-doc" aria-hidden="true" class="anchor"></a>online-doc</td><td><ul><li><a href="https://ocsigen.org/lwt">https://ocsigen.org/lwt</a></li></ul></td></tr><tr id="info-readme-files"><td><a href="#info-readme-files" aria-hidden="true" class="anchor"></a>readme-files</td><td><ul><li><a type="text/plain; charset=UTF-8" href="_doc-dir/README.md">README.md</a></li></ul></td></tr><tr id="info-repo"><td><a href="#info-repo" aria-hidden="true" class="anchor"></a>repo</td><td><ul><li>git+https://github.com/ocsigen/lwt.git</li></ul></td></tr><tr id="info-version"><td><a href="#info-version" aria-hidden="true" class="anchor"></a>version</td><td><ul><li>5.3.0</li></ul></td></tr></table></div></body></html>
